<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Nearest Centre - Khushipath</title>
    <link rel="stylesheet" href="/FP/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Base styles */
        body { padding-top: 100px; background-color: #f8f9fa; }
        .center-container { max-width: 900px; margin: 40px auto; padding: 30px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #3f51b5; font-size: 2em; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 30px; text-align: center; }
        
        /* Lab Card Styles */
        .lab-list { display: grid; gap: 20px; }
        .lab-card {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            align-items: flex-start;
            transition: box-shadow 0.2s;
            border-left: 5px solid #28a745;
        }
        .lab-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .lab-icon {
            font-size: 30px;
            color: #3f51b5;
            margin-right: 20px;
        }
        .lab-details {
            flex-grow: 1;
        }
        .lab-details h3 {
            margin-top: 0;
            margin-bottom: 5px;
            color: #333;
        }
        .lab-details p {
            margin: 3px 0;
            font-size: 0.95em;
            color: #555;
        }
        .lab-details .hours {
            font-weight: 600;
            color: #28a745;
            margin-top: 10px;
        }
        .status-badge {
            font-size: 0.8em;
            padding: 4px 8px;
            background-color: #e0f2f1;
            border-radius: 5px;
            color: #009688;
        }
        .not-found {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <img src="/FP/image/khushipath logo.png" alt="Khushipath Logo" />
                <h1>Khushipath</h1>
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/About">About Us</a></li>
            <li><a href="/Tes">Tests</a></li>
            <li><a href="/Packages">Packages</a></li>
            <li><a href="/Doctor">Doctors</a></li>
            <li><a href="/Contact">Contact</a></li>
            <li><a href="/Login">Login</a></li>
            <li><a href="/Cart" title="Shopping Cart"><i class="fas fa-shopping-cart"></i><span id="cart-count">0</span></a></li>
        </ul>
    </nav>
    
    <div class="center-container">
        <h1><i class="fas fa-map-marker-alt"></i> Find Your Nearest Khushipath Centre</h1>
        <p style="text-align: center; margin-bottom: 40px; color: #555;">Below is a list of our currently active lab centers and collection points.</p>

        <div id="labList" class="lab-list">
            <div style="text-align: center;">Loading active lab locations...</div>
        </div>
    </div>

    <script>
        const labListContainer = document.getElementById('labList');

        // Function to create an individual lab card HTML
        function createLabCard(lab) {
            const status = lab.isAvailable ? 'Active' : 'Inactive';

            return `
                <div class="lab-card">
                    <div class="lab-icon"><i class="fas fa-flask"></i></div>
                    <div class="lab-details">
                        <h3>${lab.name} (${lab.city})</h3>
                        <p><strong>Address:</strong> ${lab.address}, Pincode: ${lab.pincode}</p>
                        <p class="hours"><i class="far fa-clock"></i> ${lab.workingHours}</p>
                    </div>
                    <span class="status-badge">${status}</span>
                </div>
            `;
        }

        // Main function to fetch labs from the public API
        async function fetchLabCenters() {
            labListContainer.innerHTML = '<div style="text-align: center;">Fetching data from server...</div>';
            
            try {
                // Calls the public API endpoint GET /api/labs
                const response = await fetch('/api/labs');
                
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                
                const labs = await response.json();
                
                if (labs.length === 0) {
                    labListContainer.innerHTML = '<div class="not-found">No active lab centers are currently listed.</div>';
                    return;
                }

                // Render the labs
                labListContainer.innerHTML = labs.map(createLabCard).join('');

            } catch (error) {
                console.error('Error fetching lab data:', error);
                labListContainer.innerHTML = '<div class="not-found" style="color: red;">Error connecting to the server or database.</div>';
            }
        }
        
        // Initial load on page ready
        document.addEventListener('DOMContentLoaded', fetchLabCenters);
        
        // --- CART COUNT HELPER (Included for Navbar) ---
        function getCart() {
            const cartString = localStorage.getItem('khushipathCart');
            return cartString ? JSON.parse(cartString) : [];
        }

        function updateCartCount() {
            const cart = getCart();
            const cartCountElement = document.getElementById('cart-count');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (cartCountElement) {
                cartCountElement.textContent = totalItems;
                cartCountElement.style.display = totalItems > 0 ? 'inline-block' : 'none';
            }
        }
        document.addEventListener('DOMContentLoaded', updateCartCount);
    </script>
</body>
</html>